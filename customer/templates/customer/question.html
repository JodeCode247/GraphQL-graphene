<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Quiz App</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      margin: 0;
      background: linear-gradient( #2575fc);
      color: #333;
    }

    .card {
      background: #fff;
      padding: 30px;
      border-radius: 16px;
      box-shadow: 0 8px 20px rgba(0,0,0,0.15);
      width: 500px;
      max-width: 90%;
      text-align: center;
      animation: fadeIn 0.5s ease-in-out;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    h1, h2 {
      margin-bottom: 20px;
      color: #222;
    }

    .options {
      text-align: left;
      margin: 20px 0;
    }

    .options label {
      display: block;
      padding: 12px 15px;
      margin-bottom: 12px;
      border: 2px solid #ddd;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 16px;
      background: #fafafa;
    }

    .options input {
      margin-right: 10px;
    }

    .options label:hover {
      border-color: #2575fc;
      background: #f0f6ff;
    }

    button {
      background: #2575fc;
      color: white;
      padding: 12px 25px;
      border: none;
      border-radius: 10px;
      font-size: 16px;
      cursor: pointer;
      transition: 0.3s ease;
    }

    button:hover {
      background: #1b5ed7;
    }

    button:disabled {
      background: #ccc;
      cursor: not-allowed;
    }

    .progress {
      margin-top: 20px;
      font-size: 14px;
      color: #666;
    }

    /* Hide quiz initially */
    #quiz-container {
      display: none;
    }
  </style>
</head>
<body>
  <!-- Scoreboard Section -->
  <div id="scoreboard"  style="position:absolute; top:20px; left:50px; width:250px;">
    <h3>üìä Scoreboard</h3>
    <p><b>User:</b> {{ clientquestion }}</p>
    <p><b>Trials:</b> <span id="trials">{{trial}}</span></p>
    <p><b>Score:</b> <span id="score">{{score}}</span></p>
  </div>
  <div id="scoreboard"  style="position:absolute; top:50px; right:50px; width:250px;">
    <h3>üìä GRAPHQL COMMAND</h3>
       <p>     query{
          allQuestions {
            id
            text
            options {
              optionAlphabet
              optionText
            }
            correctAnswer {
              answer
            }
          }
        } </p>
 <h4>copy the code and run on <strong>{websitehosturl/graphl}</strong> on your client to get the questions</h4> 

  </div>

  <!-- Welcome Screen -->
  <div class="card" id="welcome-screen">

    <h1>{% if trial > 0 %}
    Contentant {{clientquestion}}... Welcome back üòä Ready to try again?
    {% else %}

    üéâ Welcome to the Quiz!{% endif %}</h1>

    <p>Test your knowledge by answering the questions one by one.  
    Select the correct option, each question is 2 marks and click  <b>Next</b> to proceed.</p>
    <p>    <a href="https://x.com/JHNwizugbe">Meet Developer</a>
</p>
    <button id="start-btn">Start Quiz</button>
  </div>

  <!-- Quiz Container -->
  <div class="card" id="quiz-container">
    <h2 id="question-text">{{ questions.0.text }}</h2>
    <form id="quiz-form">
      <div class="options">
        {% for option in questions.0.options %}
          <label>
            <input type="radio" name="answer" value="{{ option }}">
            {{ option }}
          </label>
        {% endfor %}
      </div>
      <button type="button" id="next-btn" disabled>Next</button>
      <div class="progress" id="progress">Question 1 of {{ questions|length }}</div>
    </form>
  </div>

  <script>
  const startBtn = document.getElementById("start-btn");
  const welcomeScreen = document.getElementById("welcome-screen");
  const quizContainer = document.getElementById("quiz-container");
  const scoreboardScore = document.getElementById("score");
  const scoreboardTrials = document.getElementById("trials");


  const questions = {{ questions_json|safe }};
  let currentIndex = 0;
  let userAnswers = [];   // store answers here ‚úÖ

  const questionText = document.getElementById("question-text");
  const form = document.getElementById("quiz-form");
  const nextBtn = document.getElementById("next-btn");
  const progress = document.getElementById("progress");

  // Show quiz when Start is clicked
  startBtn.addEventListener("click", () => {
    welcomeScreen.style.display = "none";
    quizContainer.style.display = "block";
    
  });

  form.addEventListener("change", () => {
    nextBtn.disabled = false;
  });

  nextBtn.addEventListener("click", () => {
    const selected = form.querySelector("input[name='answer']:checked");
    if (!selected) return;

    // Save selected answer
    userAnswers.push({
      question_id: questions[currentIndex].id,   // assuming each question has ID
      answer: selected.value
    });

    currentIndex++;
    if (currentIndex < questions.length) {
      loadQuestion();
    } else {
      submitResults();  // ‚úÖ send results to backend
    }
  });

  function loadQuestion() {
    const q = questions[currentIndex];
    questionText.textContent = q.text;

    const optionsDiv = form.querySelector(".options");
    optionsDiv.innerHTML = "";

    q.options.forEach(opt => {
      const label = document.createElement("label");
      label.innerHTML = `<input type="radio" name="answer" value="${opt}"> ${opt}`;
      optionsDiv.appendChild(label);
    });

    nextBtn.disabled = true;
    progress.textContent = `Question ${currentIndex + 1} of ${questions.length}`;
  }

  // ‚úÖ Send answers to backend
  async function submitResults() {
    questionText.textContent = "Submitting your answers... ‚è≥";
    form.innerHTML = "";

    try {
      const response = await fetch("submit-quiz/", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "X-CSRFToken": "{{ csrf_token }}"   // important for Django
        },
        body: JSON.stringify({ answers: userAnswers })
      });

       const data = await response.json();

      // Calculate percentage
      const percentage = ((data.correct / questions.length) * 100).toFixed(2);
      let score = scoreboardScore.textContent
      scoreboardScore.textContent = Number(score)+data.score;


      // Display result with Try Again button
      questionText.textContent = `üéâ Quiz Finished!`;
      form.innerHTML = `
        <div>
          <p>Your Score: <b>${data.score}</b></p>
          <p>Correct Answers: <b>${data.correct}</b> / ${questions.length}</p>
          <p>Percentage: <b>${percentage}%</b></p>
          <button onclick="location.reload()"> Try Again</button>
        </div>
      `;
    } catch (error) {
      console.error("Error submitting quiz:", error);
      form.innerHTML = "<p>Something went wrong while submitting.</p>";
    }
  }
</script>

</body>
</html>
